<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metaweb of European vertebrates analysis • metanetwork</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Metaweb of European vertebrates analysis">
<meta property="og:description" content="metanetwork">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metanetwork</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pyramid.html">The pyramid example</a>
    </li>
    <li>
      <a href="../articles/angola.html">The Angola dataset</a>
    </li>
    <li>
      <a href="../articles/norway.html">The Norway dataset</a>
    </li>
    <li>
      <a href="../articles/vertebrates.html">The metaweb of European vertebrates</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarcOhlmann/metanetwork/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vertebrates_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Metaweb of European vertebrates analysis</h1>
                        <h4 data-toc-skip class="author">Marc Ohlmann</h4>
            
            <h4 data-toc-skip class="date">2022-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MarcOhlmann/metanetwork/blob/HEAD/vignettes/vertebrates.Rmd" class="external-link"><code>vignettes/vertebrates.Rmd</code></a></small>
      <div class="hidden name"><code>vertebrates.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="the-european-vertebrates-data-set">The European vertebrates data set<a class="anchor" aria-label="anchor" href="#the-european-vertebrates-data-set"></a>
</h2>
<p>Metaweb of potential interactions between European terrestrial vertebrates. This data set is extracted from Maiorano et al. 2020 and O’Connor et al. 2020. It contains <span class="math inline">\(1122\)</span> vertebrate species (birds, mammals, amphibians and reptiles) and <span class="math inline">\(49883\)</span> expert-knowledge potential interactions. O’Connor et al. 2020 applied a Stochastic Block Model (SBM), a method that group together nodes with similar edge probability pattern (see Daudin et al.). This method inferred <span class="math inline">\(46\)</span> species groups. We also have classification of species in <span class="math inline">\(4\)</span> classes (Amphibians, Birds, Mammals and Reptiles).</p>
<p>In this vignette, we aim at representing this large network using SBM groups.</p>
</div>
<div class="section level2">
<h2 id="loading-the-data-set">Loading the data set<a class="anchor" aria-label="anchor" href="#loading-the-data-set"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MarcOhlmann/metanetwork" class="external-link">metanetwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GuangchuangYu/ggimage" class="external-link">ggimage</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meta_vrtb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## metaweb has 1122 nodes and 49865 edges </span></span>
<span><span class="co">## single network </span></span>
<span><span class="co">## available resolutions are: sp group Class</span></span></code></pre>
<div class="section level3">
<h3 id="append-aggregated-networks">Append aggregated networks<a class="anchor" aria-label="anchor" href="#append-aggregated-networks"></a>
</h3>
<p>To compute aggregated networks at the SBM group level and Class level, we use the <code>append_agg_nets</code> method.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_vrtb</span> <span class="op">=</span> <span class="fu"><a href="../reference/append_agg_nets.html">append_agg_nets</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compute-trophic-levels">Compute trophic levels<a class="anchor" aria-label="anchor" href="#compute-trophic-levels"></a>
</h3>
<p>In order to represent this metaweb, we compute trophic levels since it is the first axis of ‘metanetwork’ layout.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_vrtb</span> <span class="op">=</span> <span class="fu"><a href="../reference/compute_TL.html">compute_TL</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">)</span></span></code></pre></div>
<p>We represent the distribution of trophic levels of the <span class="math inline">\(4\)</span> classes and <span class="math inline">\(46\)</span> SBM groups.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TL_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span><span class="op">)</span><span class="op">$</span><span class="va">name</span>,</span>
<span>              TL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span><span class="op">)</span><span class="op">$</span><span class="va">TL</span>,</span>
<span>              group <span class="op">=</span> <span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span><span class="op">)</span>,<span class="st">"group"</span><span class="op">]</span>,</span>
<span>              class <span class="op">=</span> <span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span><span class="op">)</span>,<span class="st">"Class"</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TL_df</span><span class="op">$</span><span class="va">TL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">TL_df</span><span class="op">$</span><span class="va">TL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">TL_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">class</span>, y<span class="op">=</span><span class="va">TL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/distrib%20TL-1.png" alt=""><p class="caption">plot of chunk distrib TL</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">TL_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">TL</span><span class="op">)</span>, y<span class="op">=</span><span class="va">TL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"group"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/distrib%20TL-2.png" alt=""><p class="caption">plot of chunk distrib TL</p>
</div>
<p>We see that the four classes contain species of various trophic levels. SBM groups are more ordered in terms of trophic level, even if several trophic groups have similar trophic levels. It is a finer scale than the class level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#this group contains several eagles species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span>,<span class="st">"group"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">17</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Accipiter_gentilis"   "Aquila_adalberti"     "Aquila_clanga"        "Aquila_heliaca"       "Hieraaetus_fasciatus" "Lynx_lynx"           </span></span>
<span><span class="co">## [7] "Hyaena_hyaena"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#single group made of eagle-owl only</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span>,<span class="st">"group"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">46</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Bubo_bubo"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#this one contain wolf and fox</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span>,<span class="st">"group"</span><span class="op">]</span> <span class="op">==</span> <span class="fl">42</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Canis_lupus"   "Vulpes_vulpes"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="represent-the-metaweb">Represent the metaweb<a class="anchor" aria-label="anchor" href="#represent-the-metaweb"></a>
</h2>
<p>In order to represent this large metaweb, we first represent the network at the SBM group level. We will use then the layout at the SBM level to compute the layout at the species level. This layout is called <code>group-TL-tsne</code>, as <code>TL-tsne</code> is the diffusion based layout of <code>metanetwork</code>.</p>
<div class="section level3">
<h3 id="representation-at-the-sbm-level">Representation at the SBM level<a class="anchor" aria-label="anchor" href="#representation-at-the-sbm-level"></a>
</h3>
<p>Using <code>ggmetanet</code> and the precomputed layout for <code>beta = 0.005</code>, we first represent the web at the SBM group level</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span></span>
<span><span class="co">#custom ggnet parameters</span></span>
<span><span class="va">ggnet.custom</span> <span class="op">=</span> <span class="va">ggnet.default</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">edge.alpha</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">arrow.size</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">max_size</span> <span class="op">=</span> <span class="fl">12</span></span>
<span></span>
<span><span class="va">net_groups</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,g <span class="op">=</span> <span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb_group</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,</span>
<span>          beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>          ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span>,edge_thrs <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">net_groups</span></span></code></pre></div>
<div class="figure">
<img src="figure/SBM%20level-1.png" alt=""><p class="caption">plot of chunk SBM level</p>
</div>
<p>To compute layout for another <span class="math inline">\(\beta\)</span> value, you can do:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.0035</span></span>
<span></span>
<span><span class="va">meta_vrtb</span> <span class="op">=</span> <span class="fu"><a href="../reference/attach_layout.html">attach_layout</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,<span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb_group</span>, beta <span class="op">=</span> <span class="va">beta</span><span class="op">)</span></span>
<span><span class="co">#custom ggnet parameters</span></span>
<span><span class="va">ggnet.custom</span> <span class="op">=</span> <span class="va">ggnet.default</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">edge.alpha</span> <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">arrow.size</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">max_size</span> <span class="op">=</span> <span class="fl">12</span></span>
<span></span>
<span><span class="va">net_groups2</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,g <span class="op">=</span> <span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb_group</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,</span>
<span>          beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>          ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span>,edge_thrs <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">net_groups2</span></span></code></pre></div>
<p><img src="figure/SBM%20level%202-1.png" alt="plot of chunk SBM level 2"> The <code>attach_layout</code> method allows storing computed layout as node attribute</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#get computed layout names on metaweb_group</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/vertex_attr_names.html" class="external-link">vertex_attr_names</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb_group</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "name"              "ab"                "TL"                "layout_beta0.008"  "layout_beta0.004"  "layout_beta0.005"  "layout_beta0.0035"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="group-tl-tsne-layout">‘group-TL-tsne’ layout<a class="anchor" aria-label="anchor" href="#group-tl-tsne-layout"></a>
</h3>
<p>To represent the metaweb at the species level, we do not compute ‘TL-tsne’ at the species level. Instead, we mix the layout computed at SBM level and a regular <code>igraph</code> layout to provide a representation where species from the same group are clustered together. Such approach provides more stable and interpretable. Morever, it is more efficient in terms of computation time since it only requires <code>'TL-tsne'</code> layout computation at the SBM level instead of computing it in higher dimension at the species level.</p>
<p>We call this layout <code>'group-TL-tsne'</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span><span class="va">ggnet.custom</span> <span class="op">=</span> <span class="va">ggnet.default</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">label</span> <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">edge.alpha</span> <span class="op">=</span> <span class="fl">0.02</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">arrow.size</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">max_size</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">palette</span> <span class="op">=</span> <span class="st">"Set2"</span></span>
<span><span class="co">#add images in the legend (if NULL, legend will represent group names only)</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">img_PATH</span> <span class="op">=</span> <span class="st">"silouhette_metaweb_europe"</span></span>
<span></span>
<span><span class="va">net_group_layout</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,</span>
<span>                              beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/group-layout-1.png" alt=""><p class="caption">plot of chunk group-layout</p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net_group_layout</span></span></code></pre></div>
<div class="figure">
<img src="figure/group-layout-2.png" alt=""><p class="caption">plot of chunk group-layout</p>
</div>
<p>Since the number of groups is large (<span class="math inline">\(46\)</span>), <code>metanetwork</code> builds a legend containing shapes and colors. <span class="math inline">\(4\)</span> different shape types are ordered along the trophic level axis. By doing so, basal species groups have the same shapes (squares and big circles here). Colors are ordered along the second axis. Moreover, we use ‘phylopic’ silhouettes to illustrate each group. We choose a representative species for each group (see <code>vignettes/silouhette_metaweb_europe</code> folder for silhouettes and phylopic credits) and <code>metanetwork</code> builds the legend using <code>ggimage</code> package.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.0035</span></span>
<span><span class="co">#attaching `group-TL-tsne` for beta = 0.0035, must provide resolution for the groups</span></span>
<span><span class="va">meta_vrtb</span> <span class="op">=</span> <span class="fu"><a href="../reference/attach_layout.html">attach_layout</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,<span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span>,<span class="va">beta</span>,</span>
<span>                          mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,res <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="co">#representing it</span></span>
<span><span class="va">net_group_layout2</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,</span>
<span>                              beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/group-layout2-1.png" alt=""><p class="caption">plot of chunk group-layout2</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net_group_layout2</span></span></code></pre></div>
<div class="figure">
<img src="figure/group-layout2-2.png" alt=""><p class="caption">plot of chunk group-layout2</p>
</div>
<p>The legend is different from the previous plot due to stochasticity of <code>'TL-tsne</code> layout. However, since trophic level is fixed, shapes remain the same.</p>
</div>
<div class="section level3">
<h3 id="tl-tsne-layout">‘TL-tsne’ layout<a class="anchor" aria-label="anchor" href="#tl-tsne-layout"></a>
</h3>
<p>We represent here the web at species level using <code>'TL-tsne'</code> layout. We do not recommand to use this layout for large networks since it is hard to interpret, unstable and costly in terms of computation time.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">4e-06</span></span>
<span></span>
<span><span class="co">#add images in the legend (if NULL, legend will represent group names only)</span></span>
<span><span class="va">ggnet.custom</span><span class="op">$</span><span class="va">img_PATH</span> <span class="op">=</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>, mode <span class="op">=</span> <span class="st">'TL-tsne'</span>,</span>
<span>          ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span>,flip_coords <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/TL-tsne%20species-1.png" alt="plot of chunk TL-tsne species"><img src="figure/TL-tsne%20species-2.png" alt="plot of chunk TL-tsne species"></p>
<p>It highlights the fact that basal species groups are not well separated on the <code>TL-tsne</code> axis.</p>
</div>
</div>
<div class="section level2">
<h2 id="playing-with-representation-parameters">Playing with representation parameters<a class="anchor" aria-label="anchor" href="#playing-with-representation-parameters"></a>
</h2>
<div class="section level3">
<h3 id="group-tl-tsne-configuration">
<code>group-TL-tsne</code> configuration<a class="anchor" aria-label="anchor" href="#group-tl-tsne-configuration"></a>
</h3>
<p>If the mean position of groups in <code>'group-TL-tsne'</code> layout is fixed, a configuration object allows controlling for height and width of the groups in the same way than <code>ggnet.config</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.0035</span></span>
<span></span>
<span><span class="co"># group-layout config</span></span>
<span><span class="va">group_layout.custom</span> <span class="op">=</span> <span class="va">group_layout.default</span></span>
<span><span class="va">group_layout.custom</span><span class="op">$</span><span class="va">nbreaks_group</span> <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="va">group_layout.custom</span><span class="op">$</span><span class="va">group_height</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">group_layout.custom</span><span class="op">$</span><span class="va">group_width</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#attaching `group-TL-tsne` for beta = 0.0035, must provide resolution for the groups</span></span>
<span><span class="va">meta_vrtb</span> <span class="op">=</span> <span class="fu"><a href="../reference/attach_layout.html">attach_layout</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,<span class="va">meta_vrtb</span><span class="op">$</span><span class="va">metaweb</span>,<span class="va">beta</span>,</span>
<span>                          mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,res <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>                          group_layout.config <span class="op">=</span> <span class="va">group_layout.custom</span><span class="op">)</span></span>
<span><span class="co">#representing it</span></span>
<span><span class="va">net_group_layout3</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,</span>
<span>                              beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/group%20config-1.png" alt=""><p class="caption">plot of chunk group config</p>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net_group_layout3</span></span></code></pre></div>
<div class="figure">
<img src="figure/group%20config-2.png" alt=""><p class="caption">plot of chunk group config</p>
</div>
</div>
<div class="section level3">
<h3 id="playing-on-transparency">Playing on transparency<a class="anchor" aria-label="anchor" href="#playing-on-transparency"></a>
</h3>
<p>In order to represent sub-networks, we advise to play on transparency (alpha). We represent here the metaweb of mammals.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span><span class="va">mammals_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">meta_vrtb</span><span class="op">$</span><span class="va">trophicTable</span><span class="op">[</span>,<span class="st">"Class"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Mammal"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net_group_layout4</span> <span class="op">=</span> <span class="fu"><a href="../reference/ggmetanet.html">ggmetanet</a></span><span class="op">(</span><span class="va">meta_vrtb</span>,flip_coords <span class="op">=</span> <span class="cn">T</span>,mode <span class="op">=</span> <span class="st">"group-TL-tsne"</span>,</span>
<span>                              beta <span class="op">=</span> <span class="va">beta</span>,legend <span class="op">=</span> <span class="st">"group"</span>,ggnet.config <span class="op">=</span> <span class="va">ggnet.custom</span>,</span>
<span>                                alpha_per_node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nodes <span class="op">=</span> <span class="va">mammals_names</span>,</span>
<span>                                                      alpha_focal <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                                                      alpha_hidden <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/mammals-1.png" alt=""><p class="caption">plot of chunk mammals</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net_group_layout4</span></span></code></pre></div>
<div class="figure">
<img src="figure/mammals-2.png" alt=""><p class="caption">plot of chunk mammals</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Maiorano, L., Montemaggiori, A., Ficetola, G. F., O’connor, L., &amp; Thuiller, W. (2020). TETRA‐EU 1.0: a species‐level trophic metaweb of European tetrapods. Global Ecology and Biogeography, 29(9), 1452-1457.</p>
<p>O’Connor, L. M., Pollock, L. J., Braga, J., Ficetola, G. F., Maiorano, L., Martinez‐Almoyna, C., … &amp; Thuiller, W. (2020). Unveiling the food webs of tetrapods across Europe through the prism of the Eltonian niche. Journal of Biogeography, 47(1), 181-192.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Marc Ohlmann, Jimmy Garnier, Laurent Vuillon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
